<template>
  <lightning-card title="Multi Contact Creator" icon-name="standard:contact">
    <!-- Repeat a simple contact form for each item in contactList -->
    <template for:each={contactList} for:item="contact" for:index="index">
      <div
        key={contact.Id}
        class="slds-m-bottom_medium slds-p-around_small slds-box slds-theme_default"
      >
        <div class="slds-grid slds-gutters slds-wrap">
          <div class="slds-col slds-size_1-of-2">
            <lightning-input
              type="text"
              length="15"
              label="First Name"
              name="FirstName"
              data-index={index}
              value={contact.FirstName}
              required
              onchange={handleInputChange}
            >
            </lightning-input>
          </div>

          <div class="slds-col slds-size_1-of-2">
            <lightning-input
              type="text"
              length="15"
              label="Last Name"
              name="LastName"
              data-index={index}
              value={contact.LastName}
              required
              onchange={handleInputChange}
            >
            </lightning-input>
          </div>

          <div class="slds-col slds-size_1-of-2">
            <lightning-input
              type="Email"
              label="Email"
              name="Email"
              data-index={index}
              value={contact.Email}
              required
              onchange={handleInputChange}
            >
            </lightning-input>
          </div>

          <div class="slds-col slds-size_1-of-2">
            <lightning-input
              label="Phone"
              name="Phone"
              maxlength="10"
              data-index={index}
              value={contact.Phone}
              required
              onchange={handleInputChange}
            >
            </lightning-input>
          </div>
        </div>

        <div class="slds-m-top_small slds-align_absolute-center">
          <lightning-button
            variant="destructive-text"
            label="Remove"
            title="Remove this contact"
            data-index={index}
            onclick={removeContactForm}
          >
          </lightning-button>
        </div>
      </div>
    </template>

    <!-- Action buttons -->
    <div class="slds-m-top_small slds-grid slds-gutters">
      <div class="slds-col">
        <lightning-button label="Add Another Contact" onclick={addContactForm}>
        </lightning-button>
      </div>

      <div class="slds-col">
        <lightning-button
          variant="brand"
          label="Save All"
          onclick={saveContactsHandler}
        >
        </lightning-button>
      </div>
    </div>

    <!-- Show created contacts in a table after save -->
    <template if:true={hasCreatedContacts}>
      <div class="slds-m-top_large">
        <template if:true={isEditMode}>
        <lightning-button
        key-field="Id"
          variant="brand"
          label="Edit"
          title="Primary action"
          onclick={handleEdit}
          class="slds-m-left_x-small"
        ></lightning-button>
        <lightning-button
        key-field="Id"
          variant="brand"
          label="Save All"
          title="Primary action"
          onclick={handleAllSave}
          class="slds-m-left_x-small">
          </lightning-button>
            <lightning-button
              key-field="Id"
              variant="brand"
              label="Cancel"
              title="Primary action"
              onclick={handleCancel}
              class="slds-m-left_x-small"
            ></lightning-button>
          </template>

        <lightning-datatable
          key-field="Id"
          data={createdContacts}
          columns={columns}
          onsave={handleAllSave}
          draft-values={draftValues}>
        </lightning-datatable>
      </div>
    </template>
  </lightning-card>
</template>
